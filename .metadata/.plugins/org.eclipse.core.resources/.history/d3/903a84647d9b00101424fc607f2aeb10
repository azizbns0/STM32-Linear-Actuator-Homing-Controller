/*
 * homing.h
 *
 *  Created on: Sep 25, 2025
 *      Author: azizb
 */

#ifndef INC_HOMING_H_
#define INC_HOMING_H_

#include <stdint.h>
#include <stdbool.h>

typedef enum {
    HOMING_STATE_IDLE = 0,
    HOMING_STATE_MOVE_TO_LEFT,
    HOMING_STATE_MOVE_TO_RIGHT_MEASURE,
    HOMING_STATE_MOVE_TO_LEFT_MEASURE,
    HOMING_STATE_MOVE_TO_MIDDLE,
    HOMING_STATE_DONE,
    HOMING_STATE_ERROR
} HomingState_t;

typedef struct {
    HomingState_t state;
    uint32_t start_tick;      // generic timestamp for current action
    uint32_t t_lr_ms;         // time left->right (full distance)
    uint32_t t_rl_ms;         // time right->left (full distance)
    uint32_t middle_time_ms;  // computed time to middle when starting from left
    uint32_t timeout_ms;      // per-step timeout
    uint32_t debounce_ms;     // debounce window for switches
    int error_code;
} HomingCtx_t;

void Homing_Init(HomingCtx_t *ctx);
void Homing_Start(HomingCtx_t *ctx);
void Homing_Step(HomingCtx_t *ctx); // call often from superloop
HomingState_t Homing_GetState(HomingCtx_t *ctx);




#endif /* INC_HOMING_H_ */
